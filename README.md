# Java Kanban

Бэкенд для трекера задач с иерархией Task / Epic / Subtask, REST API и файловой персистентностью.

## Возможности

- **CRUD-операции** — создание, чтение, обновление и удаление задач, эпиков и подзадач
- **Иерархия задач** — эпики автоматически агрегируют статус и временные рамки подзадач
- **Приоритизация** — задачи упорядочены по времени старта с валидацией пересечений
- **История просмотров** — двусвязный список с O(1) операциями добавления, удаления и поиска
- **Персистентность** — сохранение и восстановление состояния из CSV-файла
- **HTTP API** — REST-эндпоинты для управления задачами с JSON-сериализацией

## Стек

`Java 21` · `JUnit 5` · `Gson` · `com.sun.net.httpserver`

## Архитектура

```
src/
├── controllers/       # Бизнес-логика: TaskManager, HistoryManager + реализации
├── model/             # Доменные объекты: Task → Epic → Subtask
├── server/            # HTTP-слой: BaseHttpHandler + обработчики эндпоинтов
├── util/              # Enum'ы, компараторы, GSON-адаптеры
└── exceptions/        # Кастомные исключения
```

### Ключевые компоненты

| Компонент | Описание |
|-----------|----------|
| `TaskManager` | Интерфейс управления задачами (CRUD, история, приоритизация) |
| `InMemoryTaskManager` | Реализация на HashMap + TreeSet для приоритизации |
| `FileBackedTaskManager` | Расширяет InMemoryTaskManager, добавляет CSV-персистентность |
| `HistoryManager` | Интерфейс истории просмотров |
| `InMemoryHistoryManager` | Двусвязный список + HashMap для O(1) операций |
| `Managers` | Фабрика: `getDefault()`, `getBackedTaskManager()`, `loadFromFile()` |

### Бизнес-правила

- **Статус эпика** вычисляется автоматически: все подзадачи NEW → NEW, все DONE → DONE, иначе IN_PROGRESS
- **Время эпика**: startTime = min, endTime = max, duration = сумма подзадач
- **Валидация пересечений** — задачи с перекрывающимися временными интервалами отклоняются (`IntersectTaskException`)
- **Copy-on-read** — история возвращает копии задач для защиты от внешней мутации

## API-эндпоинты

Сервер запускается на порту **8080**.

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/tasks` | Получить все задачи |
| GET | `/tasks/{id}` | Получить задачу по ID |
| POST | `/tasks` | Создать / обновить задачу |
| DELETE | `/tasks/{id}` | Удалить задачу по ID |
| GET | `/epics` | Получить все эпики |
| GET | `/epics/{id}` | Получить эпик по ID |
| POST | `/epics` | Создать / обновить эпик |
| DELETE | `/epics/{id}` | Удалить эпик по ID |
| GET | `/epics/{id}/subtasks` | Получить подзадачи эпика |
| GET | `/subtasks` | Получить все подзадачи |
| GET | `/subtasks/{id}` | Получить подзадачу по ID |
| POST | `/subtasks` | Создать / обновить подзадачу |
| DELETE | `/subtasks/{id}` | Удалить подзадачу по ID |
| GET | `/history` | Получить историю просмотров |
| GET | `/prioritized` | Получить задачи по приоритету |

**Коды ответов:** `200` OK · `201` Created · `400` Bad Request · `404` Not Found · `406` Not Acceptable (пересечение времени)

## Тестирование

Тесты написаны на **JUnit 5** и расположены в `test/`, зеркально повторяя структуру `src/`.

- `TaskManagerTest<T>` — абстрактный шаблон; подклассы переопределяют `createTaskManager()` для тестирования обеих реализаций единым набором тестов
- HTTP-тесты поднимают реальный сервер в `@BeforeEach` / `@AfterEach` и используют `HttpClient`
